<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Music Pack 1 - Player</title>
<style>
  * {
    box-sizing: border-box;
    margin: 0; padding: 0;
  }
  body {
    background: #121212;
    color: #fff;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  header {
    padding: 1rem;
    background: #1f1f1f;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }
  header h1 {
    font-weight: 700;
    font-size: 1.5rem;
    color: #1db954;
  }
  nav {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  nav button {
    background: #282828;
    border: none;
    color: #fff;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s;
  }
  nav button:hover {
    background: #1db954;
  }

  main {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
  }
  ul#playlist {
    list-style: none;
  }
  ul#playlist li {
    padding: 0.75rem 1rem;
    border-radius: 10px;
    margin-bottom: 0.5rem;
    background: #282828;
    cursor: pointer;
    transition: background 0.3s;
  }
  ul#playlist li:hover,
  ul#playlist li.playing {
    background: #1db954;
    color: #000;
  }

  footer {
    background: #181818;
    padding: 1rem;
    box-shadow: 0 -2px 10px rgb(0 0 0 / 0.7);
    position: sticky;
    bottom: 0;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  audio {
    width: 100%;
    max-width: 600px;
    outline: none;
    border-radius: 10px;
    background: #000;
  }

  @media (max-width: 600px) {
    header h1 {
      width: 100%;
      text-align: center;
      margin-bottom: 0.5rem;
    }
    nav {
      justify-content: center;
      width: 100%;
    }
  }
</style>
</head>
<body>

<header>
  <h1>Music Pack 1</h1>
  <nav>
    <button onclick="window.open('https://zoniumgames.github.io/music-pack1-server/', '_blank')">Pack 1</button>
    <button onclick="window.open('https://zoniumgames.github.io/music-pack2-server/', '_blank')">Pack 2</button>
    <button onclick="window.open('https://zoniumgames.github.io/music-pack3-server/', '_blank')">Pack 3</button>
    <button onclick="window.open('https://zoniumgames.github.io/music-pack4-server/', '_blank')">Pack 4</button>
    <button onclick="window.open('https://zoniumgames.github.io/music-pack5-server/', '_blank')">Pack 5</button>
    <button onclick="window.open('https://zoniumgames.github.io/music-pack6-server/', '_blank')">Pack 6</button>
  </nav>
</header>

<main>
  <ul id="playlist"></ul>
</main>

<footer>
  <audio id="audio" controls></audio>
</footer>

<script>
  const user = 'Zoniumgames';  // Cambia si usas otro usuario
  const repo = 'music-pack1-server';  // Cambia para cada repo
  const branch = 'main'; // O master si usas master
  const playlistEl = document.getElementById('playlist');
  const audioEl = document.getElementById('audio');

  let currentIndex = -1;
  let songs = [];

  // Obtener lista de archivos mp3 desde GitHub API (raíz del repo)
  async function fetchSongs() {
    try {
      const res = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/?ref=${branch}`);
      const data = await res.json();

      if (!Array.isArray(data)) throw new Error('Error obteniendo archivos');

      // Filtrar sólo mp3
      songs = data
        .filter(item => item.type === 'file' && item.name.endsWith('.mp3'))
        .map(item => item.name);

      if (songs.length === 0) {
        playlistEl.innerHTML = '<li>No se encontraron canciones (.mp3) en el repositorio.</li>';
        return;
      }

      renderPlaylist();
      playSong(0);

    } catch (error) {
      playlistEl.innerHTML = '<li>Error cargando canciones.</li>';
      console.error(error);
    }
  }

  // Renderizar lista de canciones
  function renderPlaylist() {
    playlistEl.innerHTML = '';
    songs.forEach((song, i) => {
      const li = document.createElement('li');
      li.textContent = song.replace('.mp3', '');
      li.addEventListener('click', () => playSong(i));
      playlistEl.appendChild(li);
    });
  }

  function playSong(index) {
    if (index < 0 || index >= songs.length) return;
    currentIndex = index;

    // URL cruda para el archivo mp3 desde github pages
    const url = `https://${user}.github.io/${repo}/${songs[currentIndex]}`;
    audioEl.src = url;
    audioEl.play();

    updatePlaying();
  }

  function updatePlaying() {
    const items = playlistEl.querySelectorAll('li');
    items.forEach((item, i) => {
      item.classList.toggle('playing', i === currentIndex);
    });
  }

  audioEl.addEventListener('ended', () => {
    currentIndex++;
    if (currentIndex >= songs.length) currentIndex = 0;
    playSong(currentIndex);
  });

  fetchSongs();
</script>

</body>
</html>